<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      html, body, #map-canvas { height: 500px; width: 400px; margin: 0; padding: 0;}
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?sensor=false">
    </script>
    <script src="https://cdn.firebase.com/js/client/1.0.21/firebase.js"></script>
  </head>
  <body>
  <button onclick="update()">Update</button>
<div id="map-canvas"></div>

    <script type="text/javascript">
      var id = '123';
      var ref = new Firebase("https://vivid-fire-7357.firebaseIO.com/trucks/" + id);
      var map;
      var marker;
      function update() {
        navigator.geolocation.getCurrentPosition(function(position) {
          ref.push({
            timestamp: Date.now(),
            coords: {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            }
          });
        });

      }

      // Runs every time firebase data changes
      ref.on('value', function(snapshot) {
        // iterates through locations and adds markers for each (super slow, who cares)
        snapshot.forEach(function(location){
          updateMarker(location.val().coords);
        });
      });

      function updateMarker(coords) {
        if (marker)
          marker.setMap(null);
        // To add the marker to the map, use the 'map' property
        var latlng = new google.maps.LatLng(coords.lat, coords.lng);
        marker = new google.maps.Marker({
            map: map,
            position: latlng,
        });
        map.setCenter(marker.getPosition());
      }
      function initialize() {
        var mapOptions = {
          center: { lat: 37.7, lng: -122},
          zoom: 10,
          
        };
        map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </body>
</html>